title: "Advanced Usage of flowfabricr"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Advanced Usage of flowfabricr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
#' @setup
```{r setup, include=FALSE}
library(flowfabricr)
is_interactive <- interactive()
```
# Advanced Usage
# Advanced Usage

This vignette covers advanced features of `flowfabricr`, including custom HTTP requests, error handling, and working with Arrow IPC data.

## Custom HTTP Requests

You can use the low-level HTTP helpers for custom endpoints:

```{r}
if (is_interactive) {
  resp <- flowfabric_get("/healthz")
  print(httr2::resp_body_json(resp))
} else {
  cat('Skipping HTTP request: not running interactively.\n')
}
```

## Error Handling

All API errors return a structured JSON error. Use `tryCatch` to handle errors gracefully:

```{r}
if (is_interactive) {
  tryCatch({
    flowfabric_streamflow_query("bad-dataset", list())
  }, error = function(e) {
    message("API error: ", e$message)
  })
} else {
  cat('Skipping error handling example: not running interactively.\n')
}
```

## Arrow IPC Data

All data queries return Arrow tables. Convert to data.frame as needed:

df <- as.data.frame(tbl)
```{r}
if (is_interactive) {
  tbl <- flowfabric_streamflow_query("nwm-forecast", list(issue_time = "latest", scope = "features", feature_ids = c("101")))
  df <- as.data.frame(tbl)
  head(df)
} else {
  cat('Skipping Arrow IPC example: not running interactively.\n')
}
```
This vignette covers advanced features of `flowfabricr`, including custom HTTP requests, error handling, and working with Arrow IPC data.

## Custom HTTP Requests

You can use the low-level HTTP helpers for custom endpoints:

```{r}
if (is_interactive) {
  resp <- flowfabric_get("/healthz")
  print(httr2::resp_body_json(resp))
} else {
  cat('Skipping HTTP request: not running interactively.\n')
}
```

## Error Handling

All API errors return a structured JSON error. Use `tryCatch` to handle errors gracefully:

```{r}
if (is_interactive) {
  tryCatch({
    flowfabric_streamflow_query("bad-dataset", list())
  }, error = function(e) {
    message("API error: ", e$message)
  })
} else {
  cat('Skipping error handling example: not running interactively.\n')
}
```

## Arrow IPC Data

All data queries return Arrow tables. Convert to data.frame as needed:

df <- as.data.frame(tbl)
```{r}
if (is_interactive) {
  tbl <- flowfabric_streamflow_query("nwm-forecast", list(issue_time = "latest", scope = "features", feature_ids = c("101")))
  df <- as.data.frame(tbl)
  head(df)
} else {
  cat('Skipping Arrow IPC example: not running interactively.\n')
}
```
